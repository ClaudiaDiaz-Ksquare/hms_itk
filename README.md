# ITK HMS (Health Management System)

The goal of this project is to improve the organization structure of a hospital database that stores several information (patients, doctors, etc). All this through a health management system 

## Getting started

### Clone this repo from github
```console
$ git clone https://github.com/ClaudiaDiaz-Ksquare/hms_itk
```

### Install Node Dependencies

```console
$ npm install
```

### Install Typescript as a dev dependency

```console
$ npm install --D typescript
```

## Creating the database
his API uses PostgreSQL to manage the database data.
### Install PostgreSQL
https://www.postgresql.org/download/


### On the psql shell
Create a database and connect to it.
```console
# CREATE USER hmsadmin WITH PASSWORD 'root123';
# ALTER USER "hmsadmin" WITH CREATEDB;
# CREATE DATABASE hms WITH OWNER "hmsadmin‚Äù;
# \c hms "hmsadmin"
```
This Database can also be visualized through the PgAdmin GUI
![img](/imgs/pg_px.png "PgAdmin")

## Storing the environment variables
You must enter these variables in a .env file inside your repo.
```
PORT = 5001
DB_NAME = hms
DB_HOST = localhost
DB_USER = hmsadmin
DB_PASS = root123
SUPER_USER = hms@admin.com
DB_CONNSTR = uri

GOOGLE_APPLICATION_CREDENTIALS = /Users/dannaediaz/firebase_hmsitk.json
```
As you may have noticed, you also need a Google Application Credential File for using Firebase. You can get it by following the steps on this link:

https://firebase.google.com/docs/admin/setup#:~:text=In%20the%20Firebase%20console%2C%20open,confirm%20by%20clicking%20Generate%20Key.

## Run the Express server

Once you're all set, you can run the server through the VS Code terminal for example, by tipying:

````
$ npm run dev
````
If everything is correct, you'll see this message on the console "DB and Express server is up and running!"
## On the FrontEnd 
Create a firebaseConfig.js file with the following info to connect to the project in firebase. 
```js
export const firebaseConfig = {
    apiKey: "AIzaSyBX808q3CdRWE0OY_8lyHsfi6VaoDdJBY0",
    authDomain: "hms-itk-60621.firebaseapp.com",
    projectId: "hms-itk-60621",
    storageBucket: "hms-itk-60621.appspot.com",
    messagingSenderId: "398536666401",
    appId: "1:398536666401:web:9aaea30da6c3527edee260",
    measurementId: "G-LQZW46BP7C"
  };
```
React components can be used to obtain the Auth Tokens of each user.


## Postman & Endpoints
The endpoints can be found inside a Postman Collection under the name: "hms_itk.postman_collection.json". This file can be imported on Postman.

## Authentication Tokens

In order to be able to use most of the endpoints for this API you need to have a JWT generated by Firebase Auth. Once you import the file on Postman, you'll find endpoints for generating these Tokens for different user roles (be aware they expure after a while), just clock on the blue "Send" button. 

![img](/imgs/pm_token.png "PgAdmin")

You must copy and paste this token into the Authentication headers (inside value) as a Bearer token to the API. Notice how you can check or uncheck the boxes to enter your chosen Auth key on each endpoint.

![img](/imgs/pm_auth.png "PgAdmin")

 You can also create a variable for each token, which can  make it easier to modify each token with their updated values in the future. 

![img](/imgs/pm_auth_var.png "PgAdmin")


# Data Models

## U S E R
Contains basic information about all users which are classified in 3 types

```ts
type Role = "Patient" | "Doctor" | "Admin";
```

| Property   | Type        | Reference      | Comment                      |
|------------|-------------|----------------|------------------------------|
| id         | varchar(50) |  PK - Not null |                              |
| role       | varchar(10) |  FK - Not null | "admin", "doctor", "patient" |
| full_name  | varchar(40) |     Not null   |                              |
| email      | varchar(40) |     Not null   |                              |
| passwd     | varchar(40) |     Not null   |                              |
| is_active  |   Boolean   |                |         default: true        |


## P A T I E N T
Contains the patient's specific and relevant information.

| Property          | Type        | Reference              | Comment            |
|-------------------|-------------|------------------------|--------------------|
| id                |     int     | PK - Not null -Autoinc |                    |
| user_id           | varchar(50) | FK - Not null          |                    |
| gender            | varchar(10) |    Not null            | "male" or "female" |
| birthday          |     Date    |    Not null            |                    |
| blood_type        | varchar(50) |                        |                    |
| has_covid_vaccine |   Boolean   |   Not null             |                    |
| risk_factors      |varchar(150) |                        |    i.e. "Diabetes" |

## D O C T O R
Contains the doctor's specific and relevant information

| Property         | Type        | Reference               | Comment           |
|----------------- |-------------|-------------------------|-------------------|
| id               |     int     | PK - Not null - Autoinc |                   |
| user_id          | varchar(50) | FK - Not null           |                   |
| university       | varchar(80) |    Not null             |                   |
| license_num      |     int     |    Not null             |                   |
| specialty_id     | varchar(50) |    Not null             |                   |
| consulting_room  |     int     |                         |                   |



## A P P O I N T M E N T 
Contains the appointment's information and how it relates to the patients and doctors.

| Property     | Type         | Reference                 | Comment        |
|--------------|--------------|---------------------------|----------------|
| id           |      int     | PK - Not null - Autoincr  |                |
| patient_id   |      int     |         FK - Not null     |                |
| doctor_id    |      int     |         FK - Not null     |                |
| date         |     Date     |            Not null       |                |
| description  | varchar(150) |                           |                |
| is_cancelled |    Boolean   |                           | default: false |

